<!DOCTYPE html>
<html>
<head>
	<title>ClickToFlash Safari extension</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="author" content="Marc Hoyois" />
	<meta name="description" content="Prevents Flash content from loading automatically" />
	<meta name="keywords" content="safari extension, block flash, clicktoflash" />
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<header id="top">
<h1>ClickToFlash Safari extension</h1>
<p class="author">by Marc Hoyois</p>
</header>

<nav>
<a href="../">My Safari extensions</a> &gt; ClickToFlash
</nav>

<div id="download" class="nav">
<b>Download links</b>
<ul>
<li><a href="http://github.com/downloads/hoyois/safariextensions/ClickToFlash-1.7.2.safariextz">Download ClickToFlash 1.7.2</a></li>
<li><a href="http://github.com/downloads/hoyois/safariextensions/ClickToFlash.fr-1.7.2.safariextz">Télécharger ClickToFlash 1.7.2 en français</a></li>
</ul>
</div>

<div class="warning"><p>ClickToFlash 1.7.2 requires Safari 5.0.1 or newer.</p></div>

<div id="contents" class="nav">
<b>Jump to</b>
<ul>
	<li><a href="#features">Features</a></li>
	<li><a href="#settings">Settings</a></li>
	<li><a href="#changelog">Release Notes</a></li>
</ul>
</div>

<div id="intro">
<p>This is my attempt at turning the <a href="http://clicktoflash.com/">ClickToFlash web plugin</a> into a Safari extension. It has all the functionality of the plugin and then some, except the automatic downloading of videos which Safari extensions do not allow. Feel free to <a href="mailto:marc%20dot%20hoyois%20@t%20gmail%20dot%20com?subject=%5BCTF%5D%20Your%20extension%20rocks,%20but...">request features</a> and please <a href="mailto:marc%20dot%20hoyois%20@t%20gmail%20dot%20com?subject=%5BCTF%5D%20This%20piece%20of%20garbage%20doesn%27t%20work%21">report bugs</a>.</p>

<p>To unpack the source to the current directory, run <code>xar -f /path/to/ClickToFlash.safariextz -x</code>. You can also <a href="http://github.com/hoyois/clicktoflash/tree/safari-5-extension">browse the latest source</a> on GitHub.</p>
</div>

<h3 id="acknowledgements">Acknowledgements</h3>
<p>Both of my extensions owe a lot to several people. As they gain in popularity, I felt I should give more proper credits to them.</p>
<ul>
	<li>This extension is directly built on <a href="http://github.com/mattball/ClickToFlash-safari-extension">this other ClickToFlash extension</a> by Matt Ball. Although most of the Javascript code and overall organization has changed, my extension still uses two key ideas from it: a ClickToFlash class that is instantiated by every web page and an army of 'killers' having the task to find HTML5 video replacements. The awesome CSS of the placeholders is also Matt's.</li>
	<li>I learned from Félix Cloutier (developer of <a href="http://safari.laissemoichercherca.com/plugincustoms">Plugin Customs</a>) how to detect Java applets.</li>
	<li>I learned from Rodger Combs' <a href="http://combsconnections.tk/extensions/">Plugin Blocker</a> extension about AJAX requests and how to use them to fetch the URL of videos on Vimeo and Veoh.</li>
</ul>
<p>I also learned Javascript through those three extensions, so <b>thanks a lot guys!</b></p>



<h2 id="features">Features</h2>
<h3 id="features_blocking">Blocking Flash</h3>
<p>ClickToFlash replaces every Flash element by a placeholder element (fig.&nbsp;1) before the browser starts fetching the Flash content. The user can load the Flash content manually by clicking on this placeholder. Right-clicking on the placeholder reveals the usual contextual menu with one added item, 'Hide Flash', which effectively removes the HTML element from the webpage. This is useful for getting rid of Flash overlays that block access to page content. Additional contextual menu items for adding a page or source to the whitelist and unlocking all Flash elements on the page can be enabled in the <a href="#menus">settings</a>.</p>

<figure>
<img src="CTF_Flash.png" alt="Flash placeholder" />
<figcaption>Figure 1: Flash placeholder element</figcaption>
</figure>

<h3 id="features_replacing">Replacing Flash by HTML5 videos</h3>
<p>ClickToFlash is able to replace certain Flash elements by HTML5 <code>&lt;video&gt;</code> tags. The label of the placeholder is then changed accordingly, and an 'HD' prefix is added if ClickToFlash knows that the video has resolution 720p or 1080p (fig.&nbsp;2). Clicking on such a placeholder loads Safari's video player. In Snow Leopard this video player features a fullscreen button (fig.&nbsp;3) and uses hardware acceleration on supported Macs. Double-clicking inside the video player toggles looping.</p>

<figure>
<img src="CTF_H264.png" alt="Video placeholder" />
<img src="CTF_HDH264.png" alt="HD Video placeholder" />
<figcaption>Figure 2: Video placeholder elements</figcaption>
</figure>

<figure>
<img src="Safari_video_player.png" alt="Safari video player" />
<figcaption>Figure 3: Safari's video player in Snow Leopard</figcaption>
</figure>

<p>The original Flash element can still be loaded by right-clicking on the placeholder and choosing 'Load Flash', or by right-clicking the video and choosing 'Reload in Flash'.</p>

<p>By default, ClickToFlash will first try to replace a Flash element by a video playable natively (i.e. without any plugin) by QuickTime. It should succeed with the following Flash elements:</p>
<ul>
<li><b>YouTube videos.</b> Both on-site and embedded videos. All YouTube videos have H.264-encoded MP4-contained sources. Resolutions in this format are Medium (&#x2264;360p, always available), 720p, 1080p, and 4K.</li>
<li><b>Vimeo videos.</b> Both on-site and embedded videos. All Vimeo videos have H.264-encoded sources, and most of them are in MP4 containers. A few are FLV files that Safari cannot play natively. Resolutions are 360p and 720p.</li>
<li><b> Dailymotion videos.</b> Both on-site and embedded videos (not including external videos available on Dailymotion's website). All Dailymotion videos available in 'high quality' have H.264-encoded MP4-contained sources. Resolution are &#x2264;480p and 720p.</li>
<li>Flash objects with <code>&lt;video&gt;</code> fallback content.</li>
</ul>

<p>If the Perian component is installed, ClickToFlash can further replace the following elements:
<ul>
	<li>480p YouTube videos.</li>
	<li>All remaining Vimeo and Dailymotion videos.</li>
	<li><b>Veoh videos.</b> Both on-site and embedded videos (not including external videos available on Veoh's website). I was not able to find any video on Veoh with resolution higher than 360p. Contact me if you know any.</li>
</ul>

<p><b>Note.</b> Playback of nonnative codecs in Safari uses much more CPU than native playback. Moreover, if autoplay is enabled, Safari usually starts playing the video too early for smooth playback. For these reasons the feature can be disabled completely. In my casual testing, for 480p YouTube videos, playback using Perian uses on average half as much CPU as YouTube's Flash player.</p>

<h3>Download links</h3>

<p>Hovering the mouse over the bottom of a video placeholder reveals a link to the video (fig.&nbsp;4 left) that can be used to download the video directly (right-click the link and select 'Download Linked File'). Once the video player has been loaded, a similar link can be accessed by moving the mouse cursor upward from the play/pause button (fig.&nbsp;4 right).</p>

<figure>
<img src="CTF_Download1.tiff" alt="Video download link on placeholder" />
<img src="CTF_Download2.tiff" alt="Video download link on video" />
<figcaption>Figure 4: Video download links</figcaption>
</figure>

<h3>Playlists</h3>

<p>If the 'Use playlists' setting is enabled, ClickToFlash can sometimes load whole playlists into the video player. This feature is available for YouTube's on-site playlists (<code>&amp;p=</code> URLs), YouTube's embedded playlists, and JW Player playlists. When a playlist is used, an additional control bar appears above the default one, featuring the title of the video being played, previous/next buttons to navigate the playlist, and an input field that can be used to jump to a video in the playlist (fig.&nbsp;5). The title of the video also serves as a link to the video that can be used for direct download.</p>

<figure>
<img src="CTF_Playlist.png" alt="Video playlist" />
<figcaption>Figure 5: Video playlist controls</figcaption>
</figure>

<h2 id="settings">Settings</h2>

<h3 id="video_settings">Video Settings</h3>

<figure>
<img src="Video_Settings.png" alt="Video settings screenshot" />
<img src="Video_Settings2.png" alt="Video settings screenshot 2" />
<img src="Video_Settings3.png" alt="Video settings screenshot 3" />
<img src="Video_Settings4.png" alt="Video settings screenshot 4" />
</figure>

<p><b>Look for video replacements to Flash</b><br />
If unticked, ClickToFlash does not go through the process of looking for video files to replace Flash elements. All the following options are then without effect.</p>

<p><b>Use playlists</b><br />
If ticked, ClickToFlash can load whole playlists from YouTube (on-site and embedded) and the JW Player into the HTML5 video player.</p>

<p><b>Show preview image on placeholder</b><br />
If ticked, a preview image of the video is shown on the placeholder instead of the usual gray gradient. Such preview images are not available for all videos.</p>

<p><b>Load the video player automatically</b><br />
If ticked, ClickToFlash automatically replaces Flash elements on locations matching a string in the text field by <code>&lt;video&gt;</code> elements when available, without waiting for the user to click on a placeholder. Strings in the text field must be separated by commas. Simply leave the text field blank to use this behavior on all web pages.</p>

<p><b>Initial behavior</b><br />
Choose whether ClickToFlash creates <code>&lt;video&gt;</code> tags with the 'preload' attribute set to 'none', to 'auto', or with the 'autoplay' attribute. With the 'Do not buffer' option, the video will only start buffering when the 'Play' button is clicked.</p>

<p><b>Nonnative codecs</b><br />
Prescribe whether ClickToFlash considers video files that will use third-party QuickTime components to play. If 'Use only as a last resort' is selected, ClickToFlash will not load such videos unless there are no natively playable videos available. If 'Use freely' is selected, ClickToFlash will load the highest-quality video regardless of its format.</p>

<p><b>Max resolution</b><br />
An upper bound on the resolutions of the videos loaded by ClickToFlash. (Because YouTube's videos are of average quality, I find that it is worth choosing the 1080p option even on a 720p screen.)</p>

<p><b>Sound volume</b><br />
Sets the initial volume of videos created by ClickToFlash. Videos on the active page will also respond to this slider while playing.</p>

<h3 id="whitelist_settings">Whitelists</h3>

<figure>
<img src="Whitelists.png" alt="Whitelist settings screenshot" />
<img src="Whitelists2.png" alt="Whitelist settings screenshot 2" />
</figure>

<p><b>Location matches</b><br />
Matches Flash content on pages whose URL contains one of these strings.</p>

<p><b>Source matches</b><br />
Matches Flash content whose source URL contains one of these strings.</p>

<p><b>Note.</b> If a string is enclosed in parenthesis, it will be interpreted as a regular expression.</p>

<p><b>Size matches</b><br />
Small Flash elements, also called 'invisible Flash', make it difficult for the user to locate and click their placeholders. Because they are not meant to be seen, such objects usually have important behind-the-scene functions, and not allowing them to load may cripple the functionality of some pages. A common effect of invisible Flash is the message <em>Please install Flash player</em> being displayed instead of the expected Flash content: this happens because an invisible Flash element whose function is to replace this message by the Flash content failed to load. In such cases, allowing invisible elements (or adding their source to the whitelist) is required to even have the possibility to access the main content. The size of these control elements is usually 1x1 px (the minimum Flash movie size), but some websites use control elements up to 8x8 px in size.</p>

<h3 id="menus">Contextual menu items</h3>

<figure>
<img src="Contextual_menu_items.png" alt="Contextual menu items settings screenshot" />
</figure>

<p><b>Add to Whitelist</b><br />
A contextual menu item that reads 'Add Source to Whitelist' on placeholder elements and 'Add Location to Whitelist' elsewhere. When selected, a JavaScript pop-up box appears with the URL of the source or location that the user can trim before adding to the respective whitelist.</p>

<p><b>Load All Flash</b><br />
Loads all blocked Flash in a document.</p>

<p><b>View on Site</b><br />
Appears on embedded YouTube, Vimeo, Dailymotion, and Veoh videos. It loads the video on its respective website in a new tab.</p>

<p><b>Open in QuickTime Player</b><br />
Opens a video in the QuickTime Player application.</p>

<h3 id="other_settings">Other</h3>

<figure>
<img src="Other.png" alt="Other settings screenshot" />
<img src="Other2.png" alt="Other settings screenshot 2" />
</figure>

<p><b>sIFR Text</b><br />
sIFR is a pre-CSS3 technology for displaying advanced typography on the web. It uses JavaScript to replace some text elements on the page by text-mimicking Flash elements. Choose 'Show text only' to disable this process and display the original HTML text.</p>

<p><b>Opacity</b><br />
This slider controls the opacity of the placeholder elements, from invisible to opaque.</p>

<h2 id="changelog">Release Notes</h2>

<p id="v1.7.2"><b>Version 1.7.2</b> (September 4, 2010)</p>
<ul>
	<li>Fixed a potential compatibility issue with other extensions (regression introduced in 1.7)</li>
</ul>

<p id="v1.7.1"><b>Version 1.7.1</b> (September 4, 2010)</p>
<ul>
	<li>Fixed handling of elements with no source and no type (regression introduced in 1.7)</li>
</ul>

<p id="v1.7"><b>Version 1.7</b> (September 4, 2010)</p>
<ul>
	<li>Preview images on video placeholders</li>
	<li>Direct link to the video at the bottom of video placeholders</li>
	<li>The setting to load the video player automatically is now a whitelist</li>
	<li>Lighter placeholders</li>
	<li>Improved CSS of video elements (controls stay at the bottom)</li>
	<li>Adding a location or source to the whitelist loads the targeted content at once</li>
	<li>Support for YouTube's future on-site player</li>
	<li>Support for Vimeo's new universal player</li>
	<li>Use higher-quality poster images for Dailymotion videos</li>
	<li>Fixed Vimeo's SD video URLs: they now correctly points to the 360p version in all cases</li>
	<li>Fixed relative URLs resolution</li>
	<li>Fixed a vulnerability that would allow invalid HTML to bypass ClickToFlash's blocking</li>
	<li>COMING SOON: Russian localization thanks to Юлий Черкашин</li>
</ul>

<p id="v1.6.3"><b>Version 1.6.3</b> (August 20, 2010)</p>
<ul>
	<li>To download a video directly, move the mouse cursor up from the play/pause button to reveal a link</li>
	<li>Added a slider to control the opacity of the placeholder elements</li>
	<li>Most contextual menu items are now optional</li>
	<li>Added 'View in QuickTime Player' contextual menu item</li>
	<li>Tweaked the CSS so that inline objects remain inline (thanks Roberto!)</li>
	<li><del>TODO: Update this webpage&#x2026;</del></li>
</ul>

<p id="v1.6.2"><b>Version 1.6.2</b> (August 16, 2010)</p>
<ul>
	<li>First .2 release ever!</li>
	<li>The 'Load All Flash' contextual menu item is hidden if there is no blocked Flash on the page</li>
	<li>'View on YouTube' works for playlists</li>
	<li>Fixed a few unfortunate typos affecting playlist controls</li>
	<li>Fixed: volume setting became ineffective in 1.6</li>
	<li>Longest changelog yet!</li>
</ul>

<p id="v1.6.1"><b>Version 1.6.1</b> (August 14, 2010)</p>
<ul>
	<li>Added a contextual menu item to view an embedded video from YouTube, Vimeo, Dailymotion, or Veoh on the main website</li>
	<li>Fixed more: some embedded YouTube videos were not being replaced</li>
</ul>

<p id="v1.6"><b>Version 1.6</b> (August 13, 2010)</p>
<ul>
	<li>Playlist support for YouTube and the JW Player</li>
	<li>Added a contextual menu item to download the video file</li>
	<li>Fixed: some embedded YouTube videos were not being replaced</li>
</ul>

<p id="v1.5.1"><b>Version 1.5.1</b> (August 8, 2010)</p>
<ul>
	<li>Code optimization made possible by the disappearance of a bug in Safari 5.0.1</li>
</ul>

<p id="v1.5"><b>Version 1.5</b> (August 6, 2010)</p>
<ul>
	<li>Added support for Veoh videos (requires Perian)</li>
	<li>Added a setting to use nonnative codecs only as a last resort</li>
	<li>Fixed: some embedded Vimeo videos were not being replaced</li>
	<li>Worked around the fact that Safari would load fallback content upon restoring an object if fallback content was being used when it was removed</li>
</ul>

<p id="v1.4"><b>Version 1.4</b> (August 3, 2010)</p>
<ul>
	<li>Added 'Load All Flash' contextual menu item</li>
	<li>In the whitelist settings, a string enclosed in parentheses is now interpreted as a regular expression</li>
	<li>Debugging mode is now a hidden setting</li>
</ul>

<p id="v1.3"><b>Version 1.3</b> (August 2, 2010)</p>
<ul>
	<li>Extension icon by Ast A. Moore</li>
	<li>Added optional use of nonnative codecs. With Perian installed ClickToFlash can now replace:
	<ul>
		<li>360p and 480p YouTube videos</li>
		<li>all the previously unplayable Vimeo and Dailymotion videos</li>
	</ul>
	</li>
	<li>Added more control over the attributes of the <code>&lt;video&gt;</code> tags</li>
</ul>

<p id="v1.2"><b>Version 1.2</b> (August 2, 2010)</p>
<ul>
	<li>Added negated whitelisting</li>
	<li>Added an optional contextual menu item to add a source or location to the whitelist</li>
	<li>Replacement of embedded YouTube videos now works if YouTube is in HTML5 Beta (thanks again Ast!)</li>
</ul>

<p id="v1.1.1"><b>Version 1.1.1</b> (July 31, 2010)</p>
<ul>
	<li>Fixed Flash not being blocked on some sites due to invalid MIME types (thanks Ast A. Moore!)</li>
</ul>

<p id="v1.1"><b>Version 1.1</b> (July 31, 2010)</p>
<ul>
	<li>Fixed whitelisting</li>
	<li>The 'Remove Element' contextual menu item now removes all parent nodes of the element as long as they have a single child.</li>
</ul>

<p id="v1.0"><b>Version 1.0</b> (July 30, 2010)</p>
<ul>
	<li>Initial release</li>
</ul>

<footer>
<p id="footer_left">Updated on September 4, 2010</p>
<p id="footer_right"><a href="#top">To the top</a></p>
</footer>

</body>
</html>
